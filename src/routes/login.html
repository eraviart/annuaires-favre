<svelte:head>
  <title>Authentification | {config.title}</title>
</svelte:head>

<div class="auth-page">
  <div class="container page">
    <div class="row">

      <div class="col-md-6 offset-md-3 col-xs-12">
        <h1 class="text-xs-center">Sign In</h1>
        <p class="text-xs-center">
          <a href="/register">Need an account?</a>
        </p>

        <ListErrors {errors}/>

        <form on:submit="submit(event)">
          <fieldset class="form-group">
            <input class="form-control form-control-lg" name="username" type="text" placeholder="Username" bind:value=username>
          </fieldset>
          <fieldset class="form-group">
            <input class="form-control form-control-lg" name="password" type="password" placeholder="Password" bind:value=password>
          </fieldset>
          <button class="btn btn-lg btn-primary pull-xs-right" type="submit" disabled="{!username || !password}">
            Sign in
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
  import { goto } from "../../__sapper__/client"
  import config from "../config"
  import ListErrors from "../components/ListErrors.html"

  export default {
    components: { ListErrors },

    data() {
      return {
        password: "",
        username: "",
        errors: null,
      }
    },
    helpers: {
      config,
    },
    methods: {
      async submit(event) {
        event.preventDefault()

        const { password, username } = this.get()

        const response = await this.store.login({ password, username })
        if (response.errors) {
          this.set({ errors: response.errors })
        } else {
          goto("/")
        }
      },
    },
  }
</script>